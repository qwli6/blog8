<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="修改动态">修改动态</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="/static/tabler/dist/css/tabler.min.css">
    <link rel="stylesheet" href="/static/tabler/dist/css/tabler-buttons.min.css"/>
    <link rel="stylesheet" href="/static/tabler/dist/css/demo.min.css">
    <style>
        body {
            display: none;
        }
    </style>
</head>
<body class="antialiased">
<div th:replace="/console/common/left-menu::leftMenu('moment')"></div>
<div class="page">
    <div th:replace="/console/common/head-navbar::headnav('moment')"></div>
    <div class="content">
        <div class="container-xl">
           <div class="row">
               <div class="col-12">
                   <textarea name="content" class="form-control" id="" cols="30" rows="10" th:text="${moment.content}"></textarea>
               </div>
               <div class="row row-sm align-items-center">
                   <div class="col-6 col-sm-4 col-md-2 col-xl-auto">
                       <a href="javascript:void(0);" id="btn-moment-update" th:data-momentid="${moment.id}" class="btn btn-blue btn-block">
                           保存
                       </a>
                   </div>
               </div>
           </div>
        </div>
        <footer class="footer footer-transparent">
            <div class="container">
                <div class="row text-center align-items-center flex-row-reverse">
                    <div class="col-lg-auto ml-lg-auto">
                        <ul class="list-inline list-inline-dots mb-0">
                            <li class="list-inline-item"><a href="./docs/index.html" class="link-secondary">Documentation</a></li>
                            <li class="list-inline-item"><a href="./faq.html" class="link-secondary">FAQ</a></li>
                            <li class="list-inline-item"><a href="https://github.com/tabler/tabler" target="_blank" class="link-secondary">Source code</a></li>
                        </ul>
                    </div>
                    <div class="col-12 col-lg-auto mt-3 mt-lg-0">
                        Copyright © 2020
                        <a href="." class="link-secondary">Tabler</a>.
                        All rights reserved.
                    </div>
                </div>
            </div>
        </footer>
    </div>
</div>


<!-- Libs JS -->
<script type="text/javascript" th:src="@{/webjars/jquery/3.0.0/jquery.min.js}"></script>
<script src="/static/tabler/dist/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<!-- Tabler Core -->
<script src="/static/tabler/dist/js/tabler.min.js"></script>
<script>
    document.body.style.display = "block"
</script>
<script>

    let rootPath = '[[@{/}]]';
    let momentId = '[[${moment.id}]]';


    document.getElementById('btn-moment-update').addEventListener('click', function(){
        let content = document.getElementsByTagName('textarea')[0].value;

        $.ajax({
            url: rootPath + 'console/moment/' + $(this).data('momentid') + '/update',
            type: 'post',
            data: JSON.stringify({'content': content, 'allowComment': true}),
            contentType: 'application/json;charset=utf8',
            dataType: 'json',
            success: function(res){
                window.location.href= rootPath +  'console/moments';
            }
        })
    })



    function queryArticles() {

    }

    $(document).ready(function(){
        $("#btnSubmit").click(function (event) {

            //stop submit the form, we will post it manually.
            event.preventDefault();

            fire_ajax_submit();
        });

        queryArticles();
        // $("#articleTable").DataTable({
        //     ordering: false,
        //     searching: false,
        //     serverSide: true,
        //     autoWidth: true,
        //     renderer: "bootstrap",
        //     ajax: {
        //         type: 'get',
        //         dataType: 'json',
        //         url: '/console/article/query',
        //         async: false
        //     },
        //     columns: [
        //         {data: 'title', render : function(value, row, index){
        //                 let html = '<a href="">'+value+'</a>';
        //                 return html;
        //         }},
        //         {data: 'createAt'},
        //         {data: 'postAt'},
        //         {data: ''},
        //         {data: 'hits'},
        //         {data: 'comments'},
        //         {
        //             className: "td-operation text-center",
        //             data: null,
        //             defaultContent: "",
        //             orderable: false,
        //             width: "160px",
        //         }
        //     ],
        //     createRow : function(row, data, index){
        //         let $btn = $('<div class="btn-group text-cen">'+
        //             '<button type="button" class="btn btn-sm btn-primary btn-edit">修改</button>'+
        //             '<button type="button" class="btn btn-sm btn-danger btn-del">删除</button>'+
        //             '</div>'+
        //             '</div>');
        //         $('td', row).eq(6).append($btn);
        //     },
        //     paginate: {
        //         first: "首页",
        //         previous: '上页',
        //         next: '下页',
        //         last: '末页'
        //     }
        // });

       // loadData();
    });


    function fire_ajax_submit() {
        // Get form
        $("#btnSubmit").prop("disabled", true);

        let data = {
            name: document.getElementById('name').value,
            sort: document.getElementById('sort').value,
            show: document.getElementById('show').checked
        }

        $.ajax({
            type: "POST",
            url: "/console/category/saved",
            data: JSON.stringify(data),
            contentType: 'application/json;charset=utf8',
            dataType: 'json',
            success: function (data) {
                $("#btnSubmit").prop("disabled", false);
                $('#createStaticBackdrop').modal('hide');
                loadData();
            },
            error: function (e) {
                console.log("ERROR : ", e);
                $("#btnSubmit").prop("disabled", false);
            }
        });
    }

</script>
</body>
</html>